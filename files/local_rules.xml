/var/ossec/etc/rules/local_rules.xml
      - ./config/local_config/local_decoder.xml:/var/ossec/etc/decoders/local_decoder.xml
      - ./config/wazuh_indexer_ssl_certs/root-ca-manager.pem:/etc/ssl/root-ca.pem
      - ./config/wazuh_indexer_ssl_certs/wazuh.master.pem:/etc/ssl/filebeat.pem
      - ./config/wazuh_indexer_ssl_certs/wazuh.master-key.pem:/etc/ssl/filebeat.key
      - ./config/wazuh_cluster/wazuh_manager.conf:/wazuh-config-mount/etc/ossec.conf
    networks:
      - capstone-siem-network

  wazuh1.indexer:
    image: wazuh/wazuh-indexer:4.13.1
    hostname: wazuh1.indexer
    restart: always
    ports:
      - "9200:9200"
    environment:
      - "OPENSEARCH_JAVA_OPTS=-Xms1g -Xmx1g"
      - "bootstrap.memory_lock=true"
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    volumes:
      - wazuh-indexer-data-1:/var/lib/wazuh-indexer
      - ./config/wazuh_indexer_ssl_certs/root-ca.pem:/usr/share/wazuh-indexer/certs/root-ca.pem
      - ./config/wazuh_indexer_ssl_certs/wazuh1.indexer-key.pem:/usr/share/wazuh-indexer/certs/wazuh1.indexer.key
      - ./config/wazuh_indexer_ssl_certs/wazuh1.indexer.pem:/usr/share/wazuh-indexer/certs/wazuh1.indexer.pem
      - ./config/wazuh_indexer_ssl_certs/admin.pem:/usr/share/wazuh-indexer/certs/admin.pem
      - ./config/wazuh_indexer_ssl_certs/admin-key.pem:/usr/share/wazuh-indexer/certs/admin-key.pem
      - ./config/wazuh_indexer/wazuh1.indexer.yml:/usr/share/wazuh-indexer/opensearch.yml
      - ./config/wazuh_indexer/internal_users.yml:/usr/share/wazuh-indexer/opensearch-security/internal_users.yml
    networks:
      - capstone-siem-network

  wazuh2.indexer:
    image: wazuh/wazuh-indexer:4.13.1
    hostname: wazuh2.indexer
    restart: always
    environment:
      - "OPENSEARCH_JAVA_OPTS=-Xms1g -Xmx1g"
      - "bootstrap.memory_lock=true"
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    volumes:
      - wazuh-indexer-data-2:/var/lib/wazuh-indexer
      - ./config/wazuh_indexer_ssl_certs/root-ca.pem:/usr/share/wazuh-indexer/certs/root-ca.pem
      - ./config/wazuh_indexer_ssl_certs/wazuh2.indexer-key.pem:/usr/share/wazuh-indexer/certs/wazuh2.indexer.key
      - ./config/wazuh_indexer_ssl_certs/wazuh2.indexer.pem:/usr/share/wazuh-indexer/certs/wazuh2.indexer.pem
      - ./config/wazuh_indexer/wazuh2.indexer.yml:/usr/share/wazuh-indexer/opensearch.yml
      - ./config/wazuh_indexer/internal_users.yml:/usr/share/wazuh-indexer/opensearch-security/internal_users.yml
    networks:
      - capstone-siem-network

  wazuh.dashboard:
    image: wazuh/wazuh-dashboard:4.13.1
    hostname: wazuh.dashboard
    restart: always
    ports:
      - 444:5601
    environment:
      OPENSEARCH_HOSTS: "https://wazuh1.indexer:9200"
      WAZUH_API_URL: "https://wazuh.master"
      API_USERNAME: ${API_USERNAME}
      API_PASSWORD: ${API_PASSWORD}
      DASHBOARD_USERNAME: kibanaserver
      DASHBOARD_PASSWORD: kibanaserver
    volumes:
      - ./config/wazuh_indexer_ssl_certs/wazuh.dashboard.pem:/usr/share/wazuh-dashboard/certs/wazuh-dashboard.pem
      - ./config/wazuh_indexer_ssl_certs/wazuh.dashboard-key.pem:/usr/share/wazuh-dashboard/certs/wazuh-dashboard-key.pem
      - ./config/wazuh_indexer_ssl_certs/root-ca.pem:/usr/share/wazuh-dashboard/certs/root-ca.pem
      - ./config/wazuh_dashboard/opensearch_dashboards.yml:/usr/share/wazuh-dashboard/config/opensearch_dashboards.yml
      - wazuh-dashboard-config:/usr/share/wazuh-dashboard/data/wazuh/config
      - wazuh-dashboard-custom:/usr/share/wazuh-dashboard/plugins/wazuh/public/assets/custom
    depends_on:
      - wazuh1.indexer
    links:
      - wazuh1.indexer:wazuh1.indexer
      - wazuh.master:wazuh.master
    networks:
      - capstone-siem-network

  nginx:
    image: nginx:stable
    hostname: nginx
    restart: always
    ports:
      - "1514:1514"
    depends_on:
      - wazuh.master
      - wazuh.dashboard
    links:
      - wazuh.master:wazuh.master
      - wazuh.dashboard:wazuh.dashboard
    volumes:
      - ./config/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    networks:
      - capstone-siem-network

volumes:
  postgres_data:
  postgres_nginx_love_data:
    driver: local
  backup:
    driver: local
  nginx_conf:
    driver: local
  acme_challenge:
    driver: local
  nginx_modules:
    driver: local  
  nginx_love_bootstrap_state:
    driver: local
  master-wazuh-api-configuration:
  master-wazuh-etc:
  master-wazuh-logs:
  master-wazuh-queue:
  master-wazuh-integrations:
  master-wazuh-active-response:
  master-wazuh-agentless:
  master-wazuh-wodles:
  master-filebeat-etc:
  master-filebeat-var:
  worker-wazuh-api-configuration:
  worker-wazuh-etc:
  worker-wazuh-logs:
  worker-wazuh-queue:
  worker-wazuh-var-multigroups:
  worker-wazuh-integrations:
  worker-wazuh-active-response:
  worker-wazuh-agentless:
  worker-wazuh-wodles:
  worker-filebeat-etc:
  worker-filebeat-var:
  wazuh-indexer-data-1:
  wazuh-indexer-data-2:
  wazuh-indexer-data-3:
  wazuh-dashboard-config:
  wazuh-dashboard-custom:

networks:
  capstone-siem-network: {}
  capstone-dmz-network: {}

oke, bây giờ bạn sẽ tạo trước cho tôi template của wazuh manager, chỉ manager thôi còn indexer và dashboard thì sẽ để user tự deploy riêng theo docker compose tôi cấp, trong docker compose thì indexer và dashboard sẽ có biến env của manager là có thể tùy chỉnh, và tôi sẽ đặt ip của manager là ip tĩnh, set biến env theo đó luôn, như vậy thì sau này có thể scale indexer bao nhiêu tùy thích mà không phải sửa đổi template
tôi cung cấp thêm các file cấu hình của wazuh manager:
local_rules.xml:
<group name="custom,web,fim,attack_chain,">

  <!-- ================= BASE WEB EVENT ================= -->

  <rule id="100000" level="2">
    <if_group>json</if_group>
    <field name="transaction.producer.modsecurity">.</field>
    <description>ModSecurity log detected</description>
  </rule>

    <!-- ================= SQL INJECTION ================= -->

  <rule id="100010" level="10">
    <if_sid>100000</if_sid>
    <regex>942100|attack-sqli|SQL Injection</regex>
    <description>SQL Injection attempt detected</description>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>
    <!-- ================= SQL Blocked ================= -->
  <rule id="100021" level="12">
    <if_sid>100010</if_sid>
    <field name="transaction.response.http_code">403</field>
    <description>SQL Injection blocked by WAF</description>
  </rule>

    <!-- ================= SQL success ================= -->
    <rule id="100022" level="8">
      <if_sid>100010</if_sid>
      <field name="transaction.response.http_code">200</field>
      <description>SQL Injection successful (HTTP 200)</description>
    </rule>

    <!-- ================= FIM ================= -->

  <rule id="100100" level="8">
    <if_group>syscheck</if_group>
    <field name="syscheck.event">added</field>
    <description>File added to system</description>
  </rule>

  <rule id="100101" level="10">
    <if_sid>100100</if_sid>
    <field name="syscheck.path">/dvwa_upload/</field>
    <description>File uploaded to web directory</description>
    <mitre>
      <id>T1505</id>
    </mitre>
  </rule>

  <rule id="100102" level="13">
    <if_sid>100101</if_sid>
    <field name="syscheck.path">.php</field>
    <description>Webshell file detected (.php)</description>
    <mitre>
      <id>T1505</id>
    </mitre>
  </rule>

  <!-- ================= CORRELATION ================= -->

  <rule id="100200" level="15">
    <if_matched_sid>100010</if_matched_sid>
    <if_matched_sid>100101</if_matched_sid>
    <description>ATTACK CHAIN: SQL Injection followed by file upload</description>
    <mitre>
      <id>T1190</id>
      <id>T1505</id>
    </mitre>
  </rule>

</group>
